# 混合体系背后的思考

一个技术体系的选择并不是选择越前沿的技术越好，而是要考虑当前所处的环境，也就是当前所能提供的基础服务，人才储备，成本，以及考虑所需要应用的场景等。

下面的内容主要是我们团队当时发生的一些故事以及一些思考，大家可以借鉴参考，故事的最开始应该是发生在2017年初吧。

## 技术选型

那个时候刚来到新公司半年多点，陆陆续续入职了一些前端开发，大概前端总人数7、8个人吧，客户端人数4个人左右。公司蒸蒸日上，但业务压力也越来越大，这时大家就提出了一个想法，我们要么把混合APP重新搞一下吧，不然现在的jsBridge方案会让大家加越来越多的班的，为了后期不加班大家全票通过。

我们列了几个方案：1.react-native 2.Ionic 3.Weex 4.cordova 5.APP里面嵌web。 那个时候我们也不太懂这块的内容，当然什么Flutter、PWA、小程序啊那个时候大厂们都还藏着，没发出来，所以大家也不知道。首先第一波讨论之后就把Ionic、weex排除掉了，嵌入web的一直这么干，肯定要升级，所以也排除了，那就只能在 RN 和 cordova 两个中选择了。一开始大家都觉得都是有 react 基础的，而且那个时候 react-native 那么火热，是个前端肯定都想选择 RN，学习一下也好。

但是最后经过一番讨论之后，我们优先选择了 cordova，不是说 RN 不好，而是当时业务压力相对已经较大，一半的前端童鞋其实 react 掌握的还不是很好，还在疲于业务，转 RN 的学习成本在当时团队上不太能够接受。而我们绝大部分业务都是内部工具 APP，对于体验要求没有那么高，只需要能够快速开发，那 cordova 方案则为首选，社区也提供了许多的底层 api 插件，无需重新开发，同时一份 cordova 桥接脚本开发的 H5 可以在APP中使用，也可以发布在线访问，这是当前最需要的。在后期的实践中也发现，cordova确实是当时最好的选择了。

## 产品结构

选定以 cordova 为基础的混合开发之后，我们初期的 APP 产品结构大概是如下图这样子的，他满足了快速开发产品上线的要求，同时也将桥接层和插件层进行了剥离，提升了可维护性。

<img src="http://img.dongbizhen.com/blog/产品结构第一版.png" width="400px" />

慢慢的，我们对混合APP的体验有了要求，优化了在线资源，和版本库管理，大概结构如下图。

<img src="http://img.dongbizhen.com/blog/产品结构第二版.png" width="400px" />

慢慢的，我们要求一个APP中能够自由的打包多个H5离线资源，我们调整资源管理模式，大概结构如下图。

<img src="http://img.dongbizhen.com/blog/产品结构第三版.png" width="400px" />

经过多次费劲折腾之后，目前产品具有相对较好的体验，以及支持可单独发布H5，单独发布APP，同时还支持不同版本的APP，能够自定义配置不同版本的H5资源包。

## 架构设计

整体结构大概可以分为三块内容: 1.基础服务（app/h5项目框架、app/h5组件库）2.发布系统（对每个项目单独打包，发布）3.业务中台（因APP发布的特殊性，需要业务中台做APP管理）。大概结构可以参考下图。

<img src="http://img.dongbizhen.com/blog/混合整体结构.png" width="400px" />

对于混合体系来说，做的好不好，发布安全不安全，可能和业务中台关系最大。下图主要大概介绍了下业务中台可以做的一些内容，当然有很多很多的内容没有展示出来，不喜勿喷。。。

<img src="http://img.dongbizhen.com/blog/业务中台结构.png" width="400px" />

以上内容主要列举了一些可以做的事，具体怎么做，以及做成怎么样，那是需要由不同团队的环境所决定的，有兴趣的童鞋可以私下进行交流。

## 团队收益

在这个过程中有一件很神奇的事，可能是通过共同搭建混合体系，前端和客户端间接的做了非常多的磨合，前端和客户端组合成了大前端部门，可喜可贺。

同样的团队开发APP效率以及APP体验有了质的提升，人均维护APP可以达到3个以上，而且基本上没有出现过特别大的问题。经过这一系列的折腾，前端对客户端底层有了更多的了解，客户端也对前端的基本内容有了足够了解，隐性的提高了团队整体水平。

当然在上面这些基础服务的背后，我们还搭建了组件库Demo应用，调试应用，监控、埋点服务等等，所有的这些为个人、团队、公司带来了极大的收益。
